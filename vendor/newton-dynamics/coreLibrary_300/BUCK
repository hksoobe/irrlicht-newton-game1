# cxx_library(
#     name = "headers",
#     headers = glob([
#         "source/newton/*.h",
#         "source/core/*.h",
#         "source/physics/*.h",
#         "source/meshUtil/*.h",
#     ]),
#     exported_headers = subdir_glob([
#         ("source/newton", "*.h"),
#         ("source/core", "*.h"),
#         ("source/physics", "*.h"),
#         ("source/meshUtil", "*.h"),
#     ]),
# )

# cxx_precompiled_header(
#     name = "NewtonStdAfx",
#     src = "source/newton/NewtonStdAfx.h",
#     deps = [
#         ":headers",
#     ],
# )

cxx_library(
    name = "coreLibrary_300",
    # precompiled_header = ":NewtonStdAfx",
    headers = glob([
        "source/core/*.h",
        "source/physics/*.h",
        "source/meshUtil/*.h",
        "source/newton/*.h"
    ]),
    exported_headers = subdir_glob([
        ("source/core", "*.h"),
        ("source/meshUtil", "*.h"),
        ("source/newton", "*.h"),
        ("source/physics", "*.h"),
    ]),
    header_namespace = "",
    srcs = glob([
        "source/core/*.cpp",
        "source/physics/*.cpp",
        "source/meshUtil/*.cpp",
        "source/newton/*.cpp"
    ]),
    compiler_flags = [
        "-fpic",
        "-msse",
        "-msse3",
        "-msse4",
        "-mfpmath=sse",
        "-ffloat-store",
        "-ffast-math",
        "-freciprocal-math",
        "-funsafe-math-optimizations",
        "-fsingle-precision-constant"
    ],
)

cxx_library(
    name = "NewtonStatic",
    deps = [ ":coreLibrary_300" ],
    exported_deps = [ ":coreLibrary_300" ],
    # preferred_linkage = "static",
    # link_style = "static",
    visibility = [ "PUBLIC" ],
)

cxx_library(
    name = "Newton",
    deps = [ ":coreLibrary_300" ],
    exported_deps = [ ":coreLibrary_300" ],
    # preferred_linkage = "shared",
    # link_style = "shared",
    visibility = [ "PUBLIC" ],
)
